# ğŸ“‹ Project Development Rules

> **Purpose**: Establish development standards and rules for this project  
> **Reference**: FHEVM Development Standards & Solutions Manual (Version 6.0)

---

## ğŸ¯ Core Principles

1. **Dual-Contract Architecture**: Always implement both FHE and Mock versions
2. **Progressive Development**: Start with Mock, then upgrade to FHE
3. **Gateway Stability**: Implement timeout, retry, and graceful degradation
4. **Wallet Compatibility**: Support both OKX and MetaMask
5. **Code Language**: All code and UI must be in English
6. **Error Handling**: Comprehensive error handling for all operations

---

## ğŸ“š Reference Documentation

### Primary Reference â­ **æœ€é«˜ä¼˜å…ˆçº§**
- **FHEVM Development Standards Manual**: 
  - Location: `FHEVM_å¼€å‘æ ‡å‡†ä¸è§£å†³æ–¹æ¡ˆæ‰‹å†Œ.md`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
  - Version: 6.1ï¼ˆåŒ…å« Sepolia FHEVM æœ€æ–°é…ç½®ï¼‰
  - Usage: **é‡åˆ°ä»»ä½•é—®é¢˜æ—¶ï¼Œå¿…é¡»å…ˆæŸ¥é˜…æ­¤æ‰‹å†Œï¼**
  - Key Sections:
    - **2.6**: Sepolia FHEVM æ­£ç¡®é…ç½®ï¼ˆ2025å¹´æœ€æ–°APIï¼‰â­
    - **3.5**: å‰ç«¯åŠ å¯†åˆ›å»ºæ ‡å‡†å®ç° â­
    - **12.3 A**: åŠ¨æ€ABIé…ç½®ï¼ˆè§£å†³å‡½æ•°ç­¾åå†²çªï¼‰
    - **12.4**: å¸¸è§é—®é¢˜é€ŸæŸ¥è¡¨ â­
    - **8-11**: Competition Guide
  - **ä½¿ç”¨å·¥å…·**: ä½¿ç”¨ `codebase_search` åœ¨æ‰‹å†Œä¸­æœç´¢ç›¸å…³å…³é”®è¯

### Project Documentation
- `README.md`: Project overview and goals
- `update_debug_log.md`: Issue tracking and solutions
- `è‡ªæŸ¥æ—¥å¿—.md`: Operation history and progress
- `docs/REFERENCE.md`: Quick reference to manual sections

---

## ğŸ› ï¸ Development Standards

### Smart Contract
- âœ… Use Solidity ^0.8.24
- âœ… Inherit from `GatewayCaller` for FHE contracts
- âœ… Implement state enums (not raw integers)
- âœ… Add request mapping system
- âœ… Set `CALLBACK_GAS_LIMIT >= 500000`
- âœ… Emit events for all critical operations
- âœ… Implement timeout and retry mechanisms

### Frontend
- âœ… Use React ^18.2.0
- âœ… Use Vite ^5.4.21
- âœ… Use ethers.js v6 (not v5)
- âœ… Use `@zama-fhe/relayer-sdk` for encryption
- âœ… Separate read/write operations (public RPC for reads)
- âœ… Use `window.ethereum.request` for OKX compatibility
- âœ… Implement Gateway polling with timeout
- âœ… All UI text in English

### Gateway Integration
- âœ… Polling interval: 5 seconds
- âœ… Max attempts: 60 (5 minutes total)
- âœ… Implement async processing (don't block UI)
- âœ… Handle 404 responses (not ready yet)
- âœ… Handle timeout gracefully
- âœ… Implement retry mechanism

### Wallet Compatibility
- âœ… Use `window.ethereum.request` for transactions (OKX)
- âœ… Explicitly set `from` address in transaction params
- âœ… Use public RPC for read operations
- âœ… Use public RPC for transaction confirmation polling
- âœ… Handle BigInt conversion: `Number(bigint.toString())`

---

## ğŸš¨ é—®é¢˜è§£å†³ä¼˜å…ˆçº§è§„åˆ™ â­ **é‡è¦ï¼**

### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šæŸ¥é˜…é¡¹ç›®æ‰‹å†Œï¼ˆå¿…é¡»ï¼‰

**é‡åˆ°ä»»ä½•æŠ€æœ¯é—®é¢˜æ—¶ï¼Œå¿…é¡»å…ˆæŸ¥é˜…æ‰‹å†Œï¼**

- **æ‰‹å†Œä½ç½®**: `FHEVM_å¼€å‘æ ‡å‡†ä¸è§£å†³æ–¹æ¡ˆæ‰‹å†Œ.md`ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰
- **æ‰‹å†Œç‰ˆæœ¬**: 6.1ï¼ˆåŒ…å« Sepolia FHEVM æœ€æ–°é…ç½®ï¼‰
- **ä½¿ç”¨æ–¹æ³•**: 
  1. ä½¿ç”¨ `codebase_search` å·¥å…·åœ¨æ‰‹å†Œä¸­æœç´¢ç›¸å…³é—®é¢˜
  2. æŸ¥æ‰¾å¯¹åº”ç« èŠ‚ï¼ˆè§ä¸‹é¢çš„å¿«é€Ÿå‚è€ƒï¼‰
  3. æŒ‰ç…§æ‰‹å†Œä¸­çš„æ­¥éª¤æ“ä½œ
  4. åœ¨å›å¤ä¸­å¼•ç”¨æ‰‹å†Œçš„å…·ä½“ç« èŠ‚å·

**é‡è¦ç« èŠ‚å¿«é€Ÿå‚è€ƒ**:
- **Sepolia FHEVM é…ç½®é—®é¢˜** â†’ ç¬¬2.6èŠ‚ï¼ˆ2025å¹´æœ€æ–°APIï¼‰
- **æ™ºèƒ½åˆçº¦é—®é¢˜** â†’ ç¬¬2èŠ‚
- **å‰ç«¯å¼€å‘é—®é¢˜** â†’ ç¬¬3èŠ‚ï¼ˆåŠ å¯†ã€è§£å¯†ã€Gatewayè½®è¯¢ï¼‰
- **ABI å‡½æ•°ç­¾åå†²çª** â†’ ç¬¬12.3 AèŠ‚ï¼ˆåŠ¨æ€ABIï¼‰
- **Gateway é—®é¢˜** â†’ ç¬¬4èŠ‚ã€ç¬¬10èŠ‚
- **é’±åŒ…å…¼å®¹æ€§é—®é¢˜** â†’ ç¬¬6èŠ‚
- **å¸¸è§é”™è¯¯é€ŸæŸ¥** â†’ ç¬¬12.4èŠ‚
- **éƒ¨ç½²é—®é¢˜** â†’ ç¬¬12.5èŠ‚
- **æ¶æ„è®¾è®¡** â†’ ç¬¬12èŠ‚

**å¿…é¡»æŸ¥é˜…æ‰‹å†Œçš„æƒ…å†µ**:
1. â— é‡åˆ°ä»»ä½•é”™è¯¯æˆ–å¼‚å¸¸ï¼ˆå¿…é¡»å…ˆåœ¨æ‰‹å†Œä¸­æŸ¥æ‰¾ï¼‰
2. â— é…ç½®é—®é¢˜ï¼ˆHardhatã€Viteã€ç¯å¢ƒå˜é‡ç­‰ï¼‰
3. â— APIä½¿ç”¨é—®é¢˜ï¼ˆåˆçº¦è°ƒç”¨ã€åŠ å¯†ã€è§£å¯†ç­‰ï¼‰
4. â— éƒ¨ç½²é—®é¢˜
5. å¼€å§‹æ–°åŠŸèƒ½å¼€å‘å‰
6. æ¶æ„è®¾è®¡å†³ç­–æ—¶

**âš ï¸ ç¦æ­¢è¡Œä¸º**:
- âŒ ä¸è¦è·³è¿‡æ‰‹å†Œç›´æ¥çŒœæµ‹è§£å†³æ–¹æ¡ˆ
- âŒ ä¸è¦é‡å¤è§£å†³æ‰‹å†Œä¸­å·²æœ‰çš„é—®é¢˜
- âŒ ä¸è¦åœ¨æœªæŸ¥é˜…æ‰‹å†Œçš„æƒ…å†µä¸‹æä¾›è§£å†³æ–¹æ¡ˆ

### ç¬¬äºŒä¼˜å…ˆçº§ï¼šé¡¹ç›®æ–‡æ¡£

- `docs/PROBLEM_SOLVING_GUIDE.md` - é—®é¢˜è§£å†³æŒ‡å—ï¼ˆæ–°ï¼‰
- `docs/REFERENCE.md` - å¿«é€Ÿå‚è€ƒ
- `docs/DEPLOYMENT.md` - éƒ¨ç½²æŒ‡å—
- `update_debug_log.md` - è°ƒè¯•æ—¥å¿—
- `è‡ªæŸ¥æ—¥å¿—.md` - æ“ä½œå†å²

### ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šå¤–éƒ¨èµ„æº

ä»…å½“å‰é¢æ‰€æœ‰èµ„æºéƒ½æ— æ³•è§£å†³é—®é¢˜æ—¶ï¼Œæ‰æŸ¥çœ‹å¤–éƒ¨èµ„æºæˆ–è¯¢é—®ç”¨æˆ·ã€‚

---

## ğŸ“– Manual Quick Referenceï¼ˆæ‰‹å†Œå¿«é€Ÿå‚è€ƒï¼‰

**Always consult the manual when**:
1. Starting a new feature
2. Encountering any error â­ **å¿…é¡»**
3. Implementing Gateway integration
4. Handling wallet compatibility issues
5. Designing architecture decisions
6. Writing tests
7. Preparing for deployment

**Manual Quick Reference**:
- Smart Contract issues â†’ Section 2, **2.6** (Sepoliaé…ç½®)
- Frontend issues â†’ Section 3
- ABI/Function signature issues â†’ Section 12.3 A (åŠ¨æ€ABI)
- Gateway issues â†’ Section 4, 10
- Wallet issues â†’ Section 6
- Competition requirements â†’ Section 8
- Architecture patterns â†’ Section 1, 12
- Common errors â†’ Section 12.4 (é€ŸæŸ¥è¡¨)

---

## ğŸ“ Update Requirements

### Before Starting Work
- [ ] **ä¼˜å…ˆæŸ¥é˜…æ‰‹å†Œ** (`FHEVM_å¼€å‘æ ‡å‡†ä¸è§£å†³æ–¹æ¡ˆæ‰‹å†Œ.md`) â­
  - ä½¿ç”¨ `codebase_search` æœç´¢ç›¸å…³é—®é¢˜
  - æŸ¥æ‰¾å¯¹åº”ç« èŠ‚çš„è§£å†³æ–¹æ¡ˆ
- [ ] Check `update_debug_log.md` for similar issues
- [ ] Update `è‡ªæŸ¥æ—¥å¿—.md` with planned changes

### During Development
- [ ] Follow code standards from manual
- [ ] Add comments for complex logic
- [ ] Test with both OKX and MetaMask

### After Completing Work
- [ ] Update `è‡ªæŸ¥æ—¥å¿—.md` with completed changes
- [ ] Update `update_debug_log.md` if issues encountered
- [ ] Verify all tests pass
- [ ] Update documentation if needed

---

## ğŸ¯ Competition Requirements

### Must-Have (Hard Requirements)
- âœ… Use real FHEVM (not Mock)
- âœ… Use `euint32`/`euint64` types
- âœ… Gateway integration (complete decryption workflow)
- âœ… Deploy to Zama network (Sepolia supported)
- âœ… Open source code (GitHub)

### Should-Have (Important)
- âœ… Solve real-world problem
- âœ… Complete UI/UX
- âœ… Comprehensive documentation
- âœ… Demo video

### Nice-to-Have (Bonus)
- âœ… Innovation in application scenario
- âœ… High code quality
- âœ… Test coverage

---

## ğŸ”§ Common Solutions Quick Reference

### Issue: OKX Wallet Not Popup
**Solution**: Section 6.2 â†’ Use `window.ethereum.request` with explicit `from`

### Issue: Transaction Confirmation Timeout
**Solution**: Section 6.3 â†’ Use public RPC polling instead of wallet provider

### Issue: Gateway Decryption Timeout
**Solution**: Section 10.3 â†’ Implement async processing + retry mechanism

### Issue: eth_call Hanging
**Solution**: Section 6.4 â†’ Use public RPC for all read operations

### Issue: BigInt Conversion Error
**Solution**: Section 6.5 â†’ Use `Number(bigint.toString())`

---

**Last Updated**: 2025-01-XX  
**Manual Version**: 6.1  
**Project Phase**: Development

---

## ğŸ“‹ é—®é¢˜è§£å†³å·¥ä½œæµç¤ºä¾‹

**ç¤ºä¾‹ï¼šé‡åˆ° "ambiguous function description" é”™è¯¯**

1. âœ… **ç¬¬ä¸€æ­¥ï¼šæŸ¥é˜…æ‰‹å†Œ**
   ```javascript
   codebase_search(
     query: "ambiguous function description ABI error",
     target_directories: ["FHEVM_å¼€å‘æ ‡å‡†ä¸è§£å†³æ–¹æ¡ˆæ‰‹å†Œ.md"]
   )
   ```
   
2. âœ… **æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ**ï¼šæ‰‹å†Œç¬¬12.3 AèŠ‚ - åŠ¨æ€ABIé…ç½®
   
3. âœ… **å®æ–½è§£å†³æ–¹æ¡ˆ**ï¼šæ ¹æ®æ‰‹å†Œä¿®æ”¹ä»£ç 
   
4. âœ… **æ›´æ–°æ—¥å¿—**ï¼šå¦‚æœæ‰‹å†Œä¸­æ²¡æœ‰ï¼Œè§£å†³åæ›´æ–°æ‰‹å†Œæˆ–è°ƒè¯•æ—¥å¿—

**è®°ä½**ï¼šå…ˆæŸ¥æ‰‹å†Œï¼Œå†åŠ¨æ‰‹ï¼

